---
import Layout from "../../../components/Layout.astro";
const BASE = import.meta.env.BASE_URL;

// Edit these strings later
const project = {
  title: "Autonomous Bin Retrieval Robot",
  subtitle: "Final Project for Introduction to Robotics (2.12)",
  date: "May 2025",
  category: "Perception, Localization, Embedded, Controls",
  tools: ["ROS2", "C++", "Controls", "OpenCV"],
  links: [
    { label: "Github", href: "https://github.com/radkinz/2.12-MobileRobot" },
  ],

gallery: [
  { src: `${BASE}projects/mobile-robot/hero-1.png`, mode: "contain" },
  { src: `${BASE}projects/mobile-robot/hero-2.jpg`, mode: "contain" },
{ src: `${BASE}projects/mobile-robot/hero-3.png`, mode: "contain" },
  { src: `${BASE}projects/mobile-robot/hero-4.jpg`, mode: "cover" },

],

};
---

<Layout title={`${project.title} — River Adkins`}>
  <section class="panel project-page">
    <!-- ===================== -->
    <!-- Back -->
    <!-- ===================== -->
    <a class="back" href={`${import.meta.env.BASE_URL}#projects`}>← Back to projects</a>

    <!-- ===================== -->
    <!-- Header -->
    <!-- ===================== -->
    <header class="project-header">
      <h1 class="project-title">{project.title}</h1>
      <p class="project-subtitle">{project.subtitle}</p>
    </header>

    <!-- ===================== -->
    <!-- Top: Gallery + Info -->
    <!-- ===================== -->
    <div class="project-top">
      <!-- Gallery -->
      <div class="gallery" data-gallery>
        <div class="gallery-track">
          {project.gallery.map((item) => (
            <div class={`gallery-slide ${item.mode === "contain" ? "is-poster" : ""}`}>
                <img src={item.src} alt="" loading="lazy" />
            </div>
            ))}

        </div>

        <div class="gallery-controls">
        <button type="button" class="gallery-btn" data-prev aria-label="Previous">←</button>
        <button type="button" class="gallery-btn" data-next aria-label="Next">→</button>
        </div>


        <div class="gallery-dots" data-dots></div>
      </div>

      <!-- Project info card -->
      <aside class="project-card">
        <h2 class="project-card-title">2.12 Mobile Robot</h2>
        <hr />
        <p><strong>Category:</strong> {project.category}</p>
        <p><strong>Project date:</strong> {project.date}</p>
        <p><strong>Tools used:</strong> {project.tools.join(", ")}</p>

        <div class="project-links">
                <a
            class="github-badge"
            href="https://github.com/radkinz/2.12-MobileRobot"
            target="_blank"
            rel="noopener noreferrer"
            >
            <svg class="github-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path
                fill="currentColor"
                d="M12 .5C5.73.5.5 5.73.5 12c0 5.09 3.29 9.39 7.86 10.91.57.1.78-.25.78-.56v-2.1c-3.2.7-3.88-1.54-3.88-1.54-.53-1.34-1.3-1.7-1.3-1.7-1.06-.72.08-.7.08-.7 1.17.08 1.79 1.2 1.79 1.2 1.04 1.78 2.73 1.27 3.4.97.1-.75.4-1.27.73-1.56-2.55-.29-5.23-1.28-5.23-5.69 0-1.26.45-2.29 1.19-3.1-.12-.29-.52-1.46.11-3.05 0 0 .97-.31 3.18 1.18a11.1 11.1 0 0 1 5.8 0c2.2-1.49 3.17-1.18 3.17-1.18.63 1.59.23 2.76.11 3.05.74.81 1.19 1.84 1.19 3.1 0 4.42-2.68 5.4-5.24 5.69.41.35.78 1.04.78 2.1v3.11c0 .31.21.66.79.55A11.51 11.51 0 0 0 23.5 12C23.5 5.73 18.27.5 12 .5z"
                />
            </svg>
            <span>2.12-MobileRobot</span>
            </a>


        </div>
      </aside>
    </div>

    <!-- ===================== -->
    <!-- Body -->
    <!-- ===================== -->
    <article class="project-body">
      <!-- Project Description -->
      <section>
        <h2>Project Description</h2>

        <p>
          This robot was designed for the final competition in MIT's 2.12 Intro to Robotics course. As a team of five, we designed a robot to autonomously navigate a course, retrieve bins, and transport them to designated zones.
        </p>

        <p>
          The platform used a two-wheel, rear-powered tank drive and a custom-designed end effector driven by a 60RPM high-torque servo to drag bins across the field. Our robot featured a Time-of-Flight sensor for short-range detection, an IMU for orientation, and a camera system mounted on a Jetson Nano for AprilTag pose estimation.
        </p>
      </section>

      <!-- Software Architecture -->
      <section>
        <h2>Software Architecture</h2>
        <p>
        The system was divided between low-level embedded motor/sensor control on an ESP32 and high-level perception, logic, and state management on the Jetson. I led the development of the low-level codebase and helped debug integration across the two systems using wireless communication.        
        </p>
        <p>
        Although our full autonomous state machine was not completed due to time constraints, we successfully developed and tested core subsystems including pose localization, bin detection, and bin pickup routines. During the competition, we were able to run all these subsystems separately and then take over manual drive when needed for small corrections. 
        </p>

      </section>

      <!-- Performance & Design -->
      <section class="project-section">
        <h2>Autonomous Task Execution</h2>
        <div>
        <div class="video-wrap">
         <video
        class="lazy-video"
        controls
        playsinline
        preload="none"
        muted
        data-src={`${import.meta.env.BASE_URL}projects/mobile-robot/binGrab.MP4`} 
        type="video/mp4" 
        poster={`${import.meta.env.BASE_URL}projects/mobile-robot/video1-poster.png`} 
        >
        Sorry, your browser doesn’t support embedded videos.
        </video>

        </div>

        <p class="caption">
        Robot autonomously grabbing a bin using AprilTag localization.        
        </p>
        </div>

                <div class="video-wrap">
      
        <video
        class="lazy-video"
        controls
        playsinline
        preload="none"
        muted
        data-src={`${import.meta.env.BASE_URL}projects/mobile-robot/binPlace.MP4`} 
        type="video/mp4" 
        poster={`${import.meta.env.BASE_URL}projects/mobile-robot/video2-poster.png`} 
        >
        Sorry, your browser doesn’t support embedded videos.
        </video>


        <p class="caption">
        Autonomous bin placement in the designated scoring zone.     
        </p>
        </div>
        

        </section>
    </article>
  </section>
</Layout>

<script is:inline>
(() => {
  const root = document.querySelector("[data-gallery]");
  if (!root) return;

  const track = root.querySelector(".gallery-track");
  const slides = [...root.querySelectorAll(".gallery-slide")];
  const prev = root.querySelector("[data-prev]");
  const next = root.querySelector("[data-next]");
  const dotsWrap = root.querySelector("[data-dots]");

  if (!track || slides.length === 0) return;

  let idx = 0;

  function setActiveDot() {
    if (!dotsWrap) return;
    [...dotsWrap.children].forEach((d, j) => d.toggleAttribute("data-active", j === idx));
  }

  function snapTo(i) {
    idx = (i + slides.length) % slides.length;

    // Prevent vertical jump by forcing "block: nearest"
    slides[idx].scrollIntoView({
      behavior: "smooth",
      inline: "start",
      block: "nearest",
    });

    setActiveDot();
  }

  if (dotsWrap) {
    dotsWrap.innerHTML = "";
    slides.forEach((_, i) => {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "gallery-dot";
      b.addEventListener("click", (e) => {
        e.preventDefault();
        snapTo(i);
      });
      dotsWrap.appendChild(b);
    });
  }

  prev?.addEventListener("click", (e) => {
    e.preventDefault();
    snapTo(idx - 1);
  });

  next?.addEventListener("click", (e) => {
    e.preventDefault();
    snapTo(idx + 1);
  });

  // When the gallery is focused, use arrow keys to navigate WITHOUT scrolling the page
  root.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") {
      e.preventDefault();
      snapTo(idx - 1);
    } else if (e.key === "ArrowRight") {
      e.preventDefault();
      snapTo(idx + 1);
    }
  });

  // Make sure the gallery can receive keyboard focus
  if (!root.hasAttribute("tabindex")) root.setAttribute("tabindex", "0");

  snapTo(0);

    const videos = document.querySelectorAll("video.lazy-video[data-src]");
    if (!videos.length) return;

    const loadVideo = (video) => {
      const src = video.dataset.src;
      if (!src) return;
      video.src = src;
      video.removeAttribute("data-src");
      // video.load(); // optional; setting src usually triggers load
    };

    if (!("IntersectionObserver" in window)) {
      videos.forEach(loadVideo);
      return;
    }

    const io = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (!entry.isIntersecting) return;
        loadVideo(entry.target);
        io.unobserve(entry.target);
      });
    }, { rootMargin: "200px 0px" }); // starts loading slightly before it appears

    videos.forEach(v => io.observe(v));
})();
</script>